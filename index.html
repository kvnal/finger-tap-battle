<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Finger Tap Battle |ü§∫</title>
    <style>
      body {
        font-family: monospace;
        height: 100vh;
        margin: 0;
        overflow: hidden;
        overscroll-behavior: contain;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      .playerBottom {
        height: 100vh;
        background-color: red;
      }
      .playerTop {
        position: absolute;
        height: 50%;
        width: 100%;
        background-color: skyblue;
      }

      /* listner layers */
      .layers {
        opacity: 1;
        /* background-color: black; */
        width: 100%;
        z-index: 100;
        position: absolute;
        height: 100vh;
      }
      .playerBottomLayer {
        display: flex;
        align-items: center;
        justify-content: center;
        border-top: 4px white dashed;
        height: 50%;
      }
      .playerTopLayer {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 50%;
      }

      .textlg {
        width: 100%;
        text-align: center;
        font-size: 8em;
        color: black;
        -webkit-text-fill-color: white; /* Will override color (regardless of order) */
        -webkit-text-stroke-width: 4px;
        -webkit-text-stroke-color: black;
      }

      .strokeText {
        color: black;
        -webkit-text-fill-color: white; /* Will override color (regardless of order) */
        -webkit-text-stroke-width: 2px;
        -webkit-text-stroke-color: black;
      }

      .rotate180 {
        transform: rotate(180deg);
      }

      .menu-container{
        height: 100vh;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        position: absolute;
        z-index: 1000;
      }
      .menu{
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        
        border: 0.5em solid black;
        width: 100%;
        background-color: white;
        box-sizing: border-box;
        padding-bottom: 2rem;
      }

      .menu h1{
        font-size: 3rem;
      }

      .menu-controls button{
        padding: 0.5em;
        font-weight: 600;
        font-size: 0.8em;
        background-color: white;
        border: 2px black solid;
        box-shadow: 4px 4px black;
      }
      
      .menu-controls button:hover {
        box-shadow: 2px 2px black;
      }
      
    </style>
  </head>
  <body>
    
    <div class="menu-container">
      
      <div class="menu">
        <h1 id="heading" class="">ü§ò New Game ü§ò</h2>
          <div class="menu-controls">
            <button onclick="startRound()">üëä Next Round </button>
            <button onclick="clearSession()">ü§ù Reset </button>
          </div>
        </div>
    </div>
    <div class="layers">
      <div class="playerTopLayer">
        <span class="textlg" id="topPlayerScore">0</span>
      </div>
      <div class="playerBottomLayer">
        <span class="textlg rotate180" id="bottomPlayerScore">0</span>
      </div>
    </div>
    <div class="playerTop"></div>
    <div class="playerBottom"></div>
  </body>

  <script>
    const newStats = {
      top: 0,
      bottom: 0,
      increment: 5 // percent of H
    };

    const screenH = document.body.scrollHeight;
    const screenW = document.body.scrollWidth;

    let increment;
    let beginGame = true;

    let topPlayerScore;
    let bottomPlayerScore;

    let topPlayerTapCounts =0;
    let bottomPlayerTapCounts =0;

    let topPlayer = document.querySelector(".playerTop");
    let bottomPlayer = document.querySelector(".playerBottom");

    let topPlayerLayer = document.querySelector(".playerTopLayer");
    let bottomPlayerLayer = document.querySelector(".playerBottomLayer");

    //click opacity 0 ,restart , mode (L,M,D) increments => game
    // dynamic increment 5%
    //rounds localstorage, reset , increments, timer 30s , count
    //check winner
    //stats display screen
    //emoji finger relative
    //countdown listner deactivate, penalty on early start

    const setDynmanicIncrement = (percentOfH = 30)=>{
      newStats.increment =  screenH * percentOfH * 0.01;
    }
    const getStats = () => {
      if (sessionStorage.getItem("stats")) {
        const stats = JSON.parse(sessionStorage.getItem("stats"));
        return stats;
      }
      return 0;
    };

    const resetLayer = () => {
      topPlayerTapCounts =0;
      bottomPlayerTapCounts=0;
      return (topPlayer.style.height = "50%");
    };

    const newGame = (reset = false) => {
      if (reset) {
        sessionStorage.clear();
        resetLayer();
      }

      if (getStats()) {
        let stats = getStats();
        topPlayerScore = stats["top"];
        bottomPlayerScore = stats["bottom"];
        increment = stats["increment"];
        return updateStatsScoreUI(topPlayerScore, bottomPlayerScore)
      } else {
        sessionStorage.setItem("stats", JSON.stringify(newStats));
        return increment = newStats.increment;
      }
    };

    const updateStatsScore = (topWinner) => {
      if (getStats()) {
        let stats = getStats();

        if (topWinner) stats["top"] += 1;
        else stats["bottom"] += 1;

        updateStatsScoreUI(topPlayerScore = stats['top'] , bottomPlayerScore = stats['bottom']);

        sessionStorage.setItem("stats", JSON.stringify(stats));
        return resetLayer();
      }
      return 0;
    };

    const updateStatsScoreUI = (topPlayerScore, bottomPlayerScore) =>{
        document.querySelector("#topPlayerScore").innerHTML = topPlayerScore
        document.querySelector("#bottomPlayerScore").innerHTML = bottomPlayerScore
    }

    const getTopPlayerScore = () => {
      return parseFloat(window.getComputedStyle(topPlayer).height.match(/\d+/));
    };

    const setTopPlayerScore = (increment) => {
      topPlayer.style.height =
        getTopPlayerScore() + increment > 0
          ? `${getTopPlayerScore() + increment}px`
          : "0px";
    };

    const checkWinner = () => {
      if (getTopPlayerScore() >= screenH) {
        console.log("Player Top winner!");
        updateStatsScore((topWinner = true));
      }
      
      if ((getTopPlayerScore() == 0 && (topPlayerTapCounts || bottomPlayerTapCounts))) {
        console.log("Player Bottom winner!");
        updateStatsScore((topWinner = false));
      }
    };

    topPlayerLayer.addEventListener("click", (event) => {
      event.preventDefault();
      event.stopPropagation();

      if (!beginGame) updateStatsScore((topWinner = false));
      else{
        topPlayerTapCounts++;
        setTopPlayerScore(increment);
        checkWinner();
      }
    });

    bottomPlayerLayer.addEventListener("click", (event) => {
      if (!beginGame) updateStatsScore((topWinner = true));
      else{
      bottomPlayerTapCounts++;
      setTopPlayerScore(-increment);
      checkWinner();}
    });

    const logStats = () => {
      console.log("screen " + screenW + " x " + screenH);
      console.log("Player top " + getTopPlayerScore());
      console.log("Player bottom " + (screenH - getTopPlayerScore()));
    };

    const startRound = () =>{

    }

    const clearSession = () =>{
      sessionStorage.clear()
      return location.reload()
    }

    setDynmanicIncrement();
    newGame();
  </script>
</html>

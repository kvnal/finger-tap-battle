<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Finger Tap Battle |ðŸ¤º</title>
    <style>
      body {
        height: 100vh;
        margin: 0;
        overflow: hidden;
      }
      .playerBottom {
        height: 100vh;
        background-color: red;
      }
      .playerTop {
        position: absolute;
        height: 50%;
        width: 100%;
        background-color: skyblue;
      }

      /* listner layers */
      .layers {
        opacity: 0.5;
        width: 100%;
        z-index: 100;
        position: absolute;
        height: 100vh;
      }
      .playerBottomLayer {
        border-top: 4px white dashed;
        background-color: black;
        height: 50%;
      }
      .playerTopLayer {
        background-color: black;
        height: 50%;
      }
    </style>
  </head>
  <body>
    <div class="layers">
      <div class="playerTopLayer"></div>
      <div class="playerBottomLayer"></div>
    </div>
    <div class="playerTop"></div>
    <div class="playerBottom"></div>
  </body>

  <script>
    const newStats = {
      top: 0,
      bottom: 0,
      increment: 50,
    };

    const screenH = window.screen.availHeight;
    const screenW = window.screen.availWidth;

    let increment;

    let topPlayerScore;
    let bottomPlayerScore;

    let topPlayer = document.querySelector(".playerTop");
    let bottomPlayer = document.querySelector(".playerBottom");

    let topPlayerLayer = document.querySelector(".playerTopLayer");
    let bottomPlayerLayer = document.querySelector(".playerBottomLayer");

    //click opacity 0 ,restart , mode (L,M,D) increments => game menu
    //rounds localstorage, reset , increments, timer 30s , count
    //check winner
    //stats display screen
    //emoji finger relative
    //countdown listner deactivate, penalty on early start

    const getStats = () => {
      if (sessionStorage.getItem("stats")) {
        const stats = JSON.parse(sessionStorage.getItem("stats"));
        return stats;
      }
      return 0;
    };

    const newGame = (reset = false) => {
      if (reset) {
        sessionStorage.clear();
      }

      if (getStats()) {
        let stats = getStats()
        topPlayerScore = stats["top"];
        bottomPlayerScore = stats["bottom"];
        increment = stats["increment"];
      } else {
        sessionStorage.setItem("stats", JSON.stringify(newStats));
      }
    };

    const updateStatsScore = (topWinner) => {
      if (getStats()) {
        let stats = getStats()

        if (topWinner) stats["top"] += 1;
        else stats["bottom"] += 1;

        return sessionStorage.setItem('stats',JSON.stringify(stats));
      }
      return 0;
    };

    const getTopPlayerScore = () => {
      return parseFloat(window.getComputedStyle(topPlayer).height.match(/\d+/));
    };

    const setTopPlayerScore = (increment) => {
      topPlayer.style.height =
        getTopPlayerScore() + increment > 0
          ? `${getTopPlayerScore() + increment}px`
          : "0px";
    };

    const checkWinner = () => {
      if (getTopPlayerScore() >= screenH) {
        console.log("Player Top winner!");
        updateStatsScore(topWinner = true)
      }
      if (getTopPlayerScore() == 0) {
        console.log("Player Bottom winner!");
        updateStatsScore(topWinner = false)
      }
    };
    //
    topPlayerLayer.addEventListener("click", (event) => {
      event.preventDefault();
      event.stopImmediatePropagation();
      event.stopPropagation();
      setTopPlayerScore(increment);
      checkWinner();
    });

    bottomPlayerLayer.addEventListener("click", (event) => {
      setTopPlayerScore(-increment);
      checkWinner();
    });

    const logStats = () => {
      console.log("screen " + screenW + " x " + screenH);
      console.log("Player top " + getTopPlayerScore());
      console.log("Player bottom " + (screenH - getTopPlayerScore()));
    };

    newGame();
  </script>
</html>
